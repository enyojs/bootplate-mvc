 <!-- generated from template for roller.js -->      <section class="file">   <header>     <span class="title">Roller.js</span>     <span class="path">source/views/Main/Roller/Roller.js</span>   </header>             <section class="group">       <section class="comments">                </section>       <section class="source">         <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  </pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <h2>The <code>Mvc.Roller</code> class</h2>

<p>This is a modified <code>enyo.Panels</code> kind housed by a container
that dynamically creates <em>panels</em> based on the models in a collection.
It just so happens in this application that collection is being
proxied via our application controller, <code>Mvc.controller</code>.</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">enyo</span><span class="p">.</span><span class="nx">kind</span><span class="p">({</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Mvc.Roller&quot;</span><span class="p">,</span>
        <span class="nx">id</span><span class="o">:</span> <span class="s2">&quot;roller&quot;</span><span class="p">,</span>
        <span class="nx">classes</span><span class="o">:</span> <span class="s2">&quot;roller-container&quot;</span><span class="p">,</span>
        <span class="nx">maxHeight</span><span class="o">:</span> <span class="mi">400</span><span class="p">,</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>For no other reason than to receive events and have relative
pathing to the controller we set the application controller
as our <em>views</em> controller</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="nx">controller</span><span class="o">:</span> <span class="s2">&quot;Mvc.controller&quot;</span><span class="p">,</span>
        <span class="nx">handlers</span><span class="o">:</span> <span class="p">{</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>We need to provide our own handler for the event
that is bubbling up from the collection controller</p>       </section>       <section class="source">         <div class="highlight"><pre>            <span class="nx">oncollectionadd</span><span class="o">:</span> <span class="s2">&quot;didAddModel&quot;</span><span class="p">,</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>We wait for the ready event before we start listening
for added models, though.</p>       </section>       <section class="source">         <div class="highlight"><pre>            <span class="nx">onready</span><span class="o">:</span> <span class="s2">&quot;syncPanelsToCollection&quot;</span>
        <span class="p">},</span>
        <span class="nx">bindings</span><span class="o">:</span> <span class="p">[</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>We have bound the <code>isEditing</code> state property to a local <code>isEditing</code>
property so we can get change notifications, this is a two-way
binding.</p>       </section>       <section class="source">         <div class="highlight"><pre>            <span class="p">{</span><span class="nx">from</span><span class="o">:</span> <span class="s2">&quot;controller.isEditing&quot;</span><span class="p">,</span> <span class="nx">to</span><span class="o">:</span> <span class="s2">&quot;isEditing&quot;</span><span class="p">,</span> <span class="nx">oneWay</span><span class="o">:</span> <span class="kc">false</span><span class="p">},</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Bind our child's <code>index</code> property to our application controller's <code>index</code>
property in a two-way binding.</p>       </section>       <section class="source">         <div class="highlight"><pre>            <span class="p">{</span><span class="nx">from</span><span class="o">:</span> <span class="s2">&quot;$.panels.index&quot;</span><span class="p">,</span> <span class="nx">to</span><span class="o">:</span> <span class="s2">&quot;controller.index&quot;</span><span class="p">,</span> <span class="nx">oneWay</span><span class="o">:</span> <span class="kc">false</span><span class="p">},</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>If for no other reason than to show it can be done, lets set
yet another two-way binding from this now bound <em>index</em> value
from the controller to ourselves.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="p">],</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>We have some specific layout functionality for mobile-ish platforms.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="nx">layoutKind</span><span class="o">:</span> <span class="s2">&quot;Mvc.RollerLayout&quot;</span><span class="p">,</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Notice we have wrapped the <code>enyo.Panels</code> <em>views</em> in this wrapper
but also a very important property - <code>controller</code> that is set to
the application controller (which just so happens to be a collection
controller) thus giving us access to the collection and its events as
well as sending our events back to the controller.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="nx">components</span><span class="o">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;panels&quot;</span><span class="p">,</span> <span class="nx">kind</span><span class="o">:</span> <span class="s2">&quot;enyo.Panels&quot;</span><span class="p">,</span> <span class="nx">draggable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">fit</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="nx">id</span><span class="o">:</span> <span class="s2">&quot;roller-panels&quot;</span><span class="p">,</span> <span class="nx">wrap</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">arrangerKind</span><span class="o">:</span> <span class="s2">&quot;enyo.TopBottomArranger&quot;</span><span class="p">}</span>
        <span class="p">],</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Handle the request when a new model has been added, this event
is dispatched from the application controller</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="nx">didAddModel</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">collection</span><span class="p">,</span> <span class="nx">model</span><span class="p">)</span> <span class="p">{</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>So we create a panel from the new model.</p>       </section>       <section class="source">         <div class="highlight"><pre>            <span class="k">this</span><span class="p">.</span><span class="nx">createPanelForModel</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>We update the index of our actual <code>enyo.Panels</code> child to that
of the new model so it is the one visible.</p>       </section>       <section class="source">         <div class="highlight"><pre>            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">panels</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">controller</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">model</span><span class="p">));</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>We flag our (two-way!) binding state for <code>isEditing</code> to <em>true</em>
so the editor will become visible. Obviously this is an indirect
reaction to the state change amongst those for any other
observers on the application state property <code>isEditing</code> but this
view did not need to be aware of any details in the rest of the app.</p>       </section>       <section class="source">         <div class="highlight"><pre>            <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;isEditing&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="p">},</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Create a panel for a model</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="nx">createPanelForModel</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">panel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">panels</span><span class="p">.</span><span class="nx">createComponent</span><span class="p">({</span><span class="nx">kind</span><span class="o">:</span> <span class="s2">&quot;Mvc.RollerPanel&quot;</span><span class="p">});</span>
            <span class="nx">panel</span><span class="p">.</span><span class="nx">controller</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="nx">model</span><span class="p">);</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Forcing a render here ensures the new panel will correctly
position itself amongst the other existing panels.</p>       </section>       <section class="source">         <div class="highlight"><pre>            <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
        <span class="p">},</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Synchronize any models in the collection to panels
we now need in our roller, the event that triggers
this is only done once, from the function in <code>enyo.run</code>
in the <code>Core.js</code> file because it loads the scaffolded
models silently then has our controller (application controller)
notify us that we can create the panels now, normally
we would go into edit mode when we detected a model
had been added but this first batch is an exception.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="nx">syncPanelsToCollection</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">enyo</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">controller</span><span class="p">.</span><span class="nx">models</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">createPanelForModel</span><span class="p">(</span><span class="nx">model</span><span class="p">)},</span> <span class="k">this</span><span class="p">);</span>
        <span class="p">},</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>So we do a little view-centric logic here with the state
by adding and removing classes thus triggering transitions
in browsers that support them.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="nx">isEditingChanged</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isEditing</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">&quot;normal&quot;</span><span class="p">))</span> <span class="k">this</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;normal&quot;</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;editing&quot;</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">&quot;editing&quot;</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;normal&quot;</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;editing&quot;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">});</span>

<span class="p">}());</span>

</pre></div>       </section>     </section>    </section>