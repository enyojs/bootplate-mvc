 <!-- generated from template for panelscontroller.js -->      <section class="file">   <header>     <span class="title">PanelsController.js</span>     <span class="path">source/controllers/PanelsController.js</span>   </header>             <section class="group">       <section class="comments">                </section>       <section class="source">         <div class="highlight"><pre></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <h2>The <code>Sample.PanelsController</code> kind</h2>

<p>This is the kind definition for the global singleton application
panels controller (<code>Sample.panels</code>) instantiated in the <code>main</code> function
in <code>Core.js</code>.</p>       </section>       <section class="source">         <div class="highlight"><pre><span class="nx">enyo</span><span class="p">.</span><span class="nx">kind</span><span class="p">({</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>We give the kind a name in the application namespace.</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Sample.PanelsController&quot;</span><span class="p">,</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>We base this kind on <code>enyo.CollectionController</code> because we know
we need the collection controller's built-in methods. Even
though this is an <code>enyo.CollectionController</code>, we can add
functionality because it's ultimately just an <code>enyo.Controller</code>
with additional features.</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">kind</span><span class="o">:</span> <span class="s2">&quot;enyo.CollectionController&quot;</span><span class="p">,</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>We already know what the collection kind is going to be for this
controller. Furthermore, we know that there will not be a shared
global instance of the collection. We will hand this controller
a kind reference and it will instantiate the collection kind when
it is created.</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">collection</span><span class="o">:</span> <span class="s2">&quot;Sample.RollerCollection&quot;</span><span class="p">,</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>The entire application has state. One possible state is the
is the editing state. While the <code>isEditing</code> property is
designed to be used directly with the <code>Sample.Roller</code> view kind,
any other component in the application may respond to it as
well (as we will see).</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">isEditing</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>This is an example of abstracting common elements to the
outermost commonly-available controller to be shared between
objects that have no direct connection but may share some
state. In this case, some of the application's functionality
is separated because of how it needs to be represented in the
DOM, but both elements need to know what <code>index</code> the roller
has selected. Using bindings, we make this property available
from the outermost controller, so that any instance of
<code>enyo.View</code> or <code>enyo.Controller</code> may access it as needed.</p>

<p>This value is actually bound to the view that implements the
<code>enyo.Panels</code> that coordinates the presentation of these
models in the <code>enyo.Collection</code>. The binding to this property
is initiated in the view.</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">index</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>A simple boolean to keep track of whether or not the animation
is running</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">isStarted</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>The timer reference as returned by <code>setInterval</code></p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">timer</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>The following methods are actually dispatch event targets of an
<code>enyo.View</code> (the toolbar). These methods are executed in response
to events bubbled from the view layer.</p>

<p>When the <code>"Edit"</code> button is tapped, we change to the editing state.</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">editModel</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>We use the <code>set</code> method even though we've published the property.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;isEditing&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">},</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>When the <code>"Add"</code> button is tapped, we add a new model to the
collection.  Its properties have the default values defined in
<code>enyo.Model</code>.</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">addModel</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Here we call the <code>add</code> method that is proxying the underlying
collection API. Because we pass in an empty hash, it knows to
create the model using all of the defaults.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">({});</span>
    <span class="p">},</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>When the <code>"Next"</code> button is tapped, we have some additional things
to do to prepare the operation.</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">nextModel</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>We freeze the current timer-driven operation/animation.</p>       </section>       <section class="source">         <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>We call our <code>next</code> method to select the next index.</p>       </section>       <section class="source">         <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Then we restart the timer operation to ensure the animation will
continue.</p>       </section>       <section class="source">         <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isEditing</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
    <span class="p">},</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Begins animation of any of the panels for the roller.</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>If we're already started, we have nothing to do.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isStarted</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Assign the <code>timer</code> property as we create a loop to animate
every 5 seconds. A great opportunity to use <code>enyo.bind</code>.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">timer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="nx">enyo</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">next</span><span class="p">),</span> <span class="mi">5000</span><span class="p">);</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>We'll use the setter to notify anyone who happens to be
listening. It is good practice to do this so that if you add
a listener later you won't wonder why the value is changing
but the observer is being notified. (Though there are cases
in which it's desirable <em>not</em> to use the setter.)</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;isStarted&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">},</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Stops animation if we are animating.</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">stop</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Clear the interval timer.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">timer</span><span class="p">)</span> <span class="nx">clearInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">timer</span><span class="p">);</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Reset our <code>isStarted</code> property, again using the setter
so that we trigger listeners (if there are any).</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;isStarted&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">},</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Selects our next index.</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">next</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Notice we're using and setting our local <code>index</code>
property, which is part of a two-way binding.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">idx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">len</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;length&quot;</span><span class="p">);</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>If the next value for index goes beyond the number of
available panels, reset it to 0 so we can start over.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">idx</span><span class="o">+</span><span class="mi">1</span> <span class="o">===</span> <span class="nx">len</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Otherwise, increment the index and move forward.</p>       </section>       <section class="source">         <div class="highlight"><pre>          <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="o">++</span><span class="nx">idx</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Listens for and lets us respond to changes in editing state.
Relies on the default behavior that if the <code>isEditing</code> property
is modified, the <code>isEditingChanged</code> method will be called (if
such a method exists).</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">isEditingChanged</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>If we are editing now, stop animating.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isEditing</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Otherwise, start animating because we just left the editing
state.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="k">else</span> <span class="k">this</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
    <span class="p">},</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Listens for length change notifications, so we can automatically
begin animating when appropriate.</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">lengthChanged</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>If the length (i.e., the number of panels) is greater than
1, start animating.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>If the length has fallen to 1, stop animating.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">});</span>

</pre></div>       </section>     </section>    </section>