 <!-- generated from template for panelscontroller.js -->      <section class="file">   <header>     <span class="title">PanelsController.js</span>     <span class="path">source/controllers/PanelsController.js</span>   </header>             <section class="group">       <section class="comments">                </section>       <section class="source">         <div class="highlight"><pre></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <h2>The <code>App.PanelsController</code> kind</h2>

<p>This is the kind definition of the global/singleton
application <em>panels controller</em> <code>App.panels</code> that is instanced
in the <code>main</code> function in <code>Core.js</code>.</p>       </section>       <section class="source">         <div class="highlight"><pre><span class="nx">enyo</span><span class="p">.</span><span class="nx">kind</span><span class="p">({</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>We name it as a kind in the application namespace.</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;App.PanelsController&quot;</span><span class="p">,</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>We subkind the <code>enyo.CollectionController</code> kind because
we know we need the collection-controller built-in methods.
Just note that even though it is a <code>enyo.CollectionController</code>
we can add additional functionality to it because it is
ultimately just another <code>enyo.Controller</code> with additional
features.</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">kind</span><span class="o">:</span> <span class="s2">&quot;enyo.CollectionController&quot;</span><span class="p">,</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>In this application we already know what the collection kind
is going to be for this controller, there is no global instance
of the collection that is shared, we are going to hand this
controller a kind reference and it will instantiate it when it
is created</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">collection</span><span class="o">:</span> <span class="s2">&quot;App.RollerCollection&quot;</span><span class="p">,</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>While in <code>Enyo.js 2.2+</code> it is not required to create the
<code>published</code> hash so that the corresponding getters/setters
are created - it is still considered good practice if
for no other reason than clarity and consistency. But it should
be noted that calling <code>get</code> or <code>set</code> on any <code>enyo.Object</code> or
subkind gives you the equivalent to <em>any property on the object</em>,
can resolve paths, handle <code>enyo.Computed</code> properties and more.
More on that another time, for now, we publish any publicly
accessible properties.</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">published</span><span class="o">:</span> <span class="p">{</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>The entire application has state, one of these states
is the editing state. While this property is designed to
be used directly with the <code>App.Roller</code> <em>view</em> kind, any
other <em>component</em> in the application can respond to it as
we will see.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="nx">isEditing</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>This is an example of abstracting common elements to
the outermost-commonly-available-controller to be
shared between objects in potentially different trees
that have no direct connection but may share some state.
In this case, some functionality in the application is
separated because of how it needs to be represented in the
DOM, but the elements both need to know what <code>index</code> the
the <em>roller</em> has selected. We present this property via
<code>enyo.Bindings</code> from the outermost controller so any
<code>enyo.View</code> or <code>enyo.Controller</code> can access it as needed.
This value is actually bound to the <code>enyo.View</code> that implements
the <code>enyo.Panels</code> that coordinate the presentation of these
models in the <code>enyo.Collection</code>. The binding to this property
is actually initiated in the view, though.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="nx">index</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Simple boolean to keep track of whether or not the animation
is running (<em>is started</em>).</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="nx">isStarted</span><span class="o">:</span> <span class="kc">false</span>
    <span class="p">},</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>The timer reference as returned by <code>setInterval</code>.</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">timer</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>We listen for one special event to trigger that we're ready
to start inspecting and listening on our property observers.</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">handlers</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">onready</span><span class="o">:</span> <span class="s2">&quot;collectionChanged&quot;</span>
    <span class="p">},</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Here we have some methods that are actually <em>dispatch event targets</em>
of an <code>enyo.View</code> (the toolbar). We'll see how that works when we
examine that view, but suffice it to say these methods are executed
because of <em>bubbled events</em> from a part of the view layer.</p>

<p>When the <code>edit</code> button is tapped, we change our state to editing.</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">editModel</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>We use the <code>set</code> setter even though we published the property.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;isEditing&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">},</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>When the <code>add</code> button is tapped, we add a new model to the collection
with the default properties as defined in the <code>enyo.Model</code> kind.</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">addModel</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Here we call the <code>add</code> method that is proxying the underlying
collection API. By passing the empy hash, it knows to create the
model with all of the defaults.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">({});</span>
    <span class="p">},</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>When the <code>next</code> button is tapped we have some additional things to
do to prepare the operation.</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">nextModel</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>We want to freeze the current timer-driven operation/animation.</p>       </section>       <section class="source">         <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>We call our <code>next</code> method to select the next index appropriately.</p>       </section>       <section class="source">         <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Now we restart the timer operation to ensure the animation will
continue.</p>       </section>       <section class="source">         <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isEditing</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
    <span class="p">},</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Begin animation of any of the panels for the roller.</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>If we're already started, we don't have anything to do.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isStarted</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Assign the <code>timer</code> property as we create our loop to
animate every 5 seconds. Great opportunity to use <code>enyo.bind</code>.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">timer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="nx">enyo</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">next</span><span class="p">),</span> <span class="mi">5000</span><span class="p">);</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Just in case anyone is listening we'll use the setter
to trigger them. It is good practice to do this so that
if you (or anyone else) adds a listener later you aren't
scratching your head wondering why the value is changing
but the <code>enyo.Observer</code> is being notified! There are
cases where it is desirable <em>not</em> to use the setter.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;isStarted&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">},</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Stop animation if we are animating.</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">stop</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Clear the interval timer.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">timer</span><span class="p">)</span> <span class="nx">clearInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">timer</span><span class="p">);</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Reset our <code>isStarted</code> property, again
using the setter so we trigger listeners if
there are any.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;isStarted&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">},</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Select our next index.</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">next</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Notice we're using and setting our local <code>index</code>
property that is part of a <em>two-way</em> <code>enyo.Binding</code>.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">idx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">len</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;length&quot;</span><span class="p">);</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>If the next value for index goes beyond the number
of available panels, reset it to <em>0</em>
so we can start over.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">idx</span><span class="o">+</span><span class="mi">1</span> <span class="o">===</span> <span class="nx">len</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Otherwise let's increment the index and move forward.</p>       </section>       <section class="source">         <div class="highlight"><pre>          <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="o">++</span><span class="nx">idx</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Listen for and allow us to respond to <em>editing state</em> changes
using the default behavior that if the <code>isEditing</code> property
is modified any <code>isEditingChanged</code> method will be called.</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">isEditingChanged</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>If we are indeed editing now we want to stop animation
pronto!</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isEditing</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Otherwise we should start animating because we just left
the editing state.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="k">else</span> <span class="k">this</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
    <span class="p">},</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>Here we listen and respond to the <em>length change</em> notification
so we can automatically begin animating when appropriate.</p>       </section>       <section class="source">         <div class="highlight"><pre>    <span class="nx">lengthChanged</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>If the length is greater than a single panel let's
go ahead and start 'er up.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span></pre></div>       </section>     </section>             <section class="group">       <section class="comments">         <p>If the length has fallen to 1 (or lower?) let's
stop animating.</p>       </section>       <section class="source">         <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">});</span>

</pre></div>       </section>     </section>    </section>